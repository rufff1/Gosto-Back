@model BlogVM
@{
    ViewData["Title"] = "BlogDetail";
}



<section>
    <div class="blog-detail ">
        <div class="containerr">
            <div class="row">
                <div class="col-lg-12">
                    <div class="path">
                        <a class="d-inline" asp-controller="home" asp-action="index">Home</a>
                        /
                        <a class="d-inline blog-category">
                            Shopping
                        </a>
                        /
                        <p class="d-inline blog-name">@Model.Blog.Title</p>
                    </div>
                </div>

                <div class="col-lg-12">
                    <div class="blog-details">
                        <div class="blog-details-img">
                            <img src="~/assets/img/Blog/@Model.Blog.Image" alt="blog-details">
                        </div>
                        <div class="blog-details-content">
                            <h2>@Model.Blog.Title</h2>
                            <h6>@Model.Blog.Author  /  @Model.Blog.BlogTime.ToString("M MMMM yyyy")  /  <i class="fa fa-comments-o"></i>@Model.Blog.Comments.Where(c => c.IsAccepted == true).Count()</h6>
                            <p>@Model.Blog.Description1</p>
                            <p>@Model.Blog.Description2</p>
                            <p class="quote">@Model.Blog.DescQuota</p>
                            <p>@Model.Blog.Description3</p>
                        </div>
                        <div class="reply-area">
                            <h3>LEAVE A REPLY</h3>
                            <p>I must explain to you how all this a mistaken idea of ncing great explorer of the rut<br> the is lder of human happinescias unde omnis iste natus error sit volptatem </p>
                            @if (User.Identity.IsAuthenticated)
                            {
                                <form id="contact-form" asp-action="AddComment" method="post">
                                    <div class="row">

                                        <div class="col-md-12">
                                            <p  id="subj">Subject</p>
                                            <input asp-for="@Model.Blog.Comments.FirstOrDefault().Subject">
                                            <p id="message">Massage</p>
                                            <textarea asp-for="@Model.Blog.Comments.FirstOrDefault().Message" cols="15" rows="10"></textarea>
                                            <p id="blogid" style="display:none">@Model.Blog.Id</p>
                                            <input type="hidden" asp-for="@Model.Blog.Comments.FirstOrDefault().BlogId" value="@Model.Blog.Id" />
                                        </div>
                                    </div>
                                    <a class="reply-btn text-decoration-none" asp-controller="Blog" asp-action="AddComment" data-text="send" id="SendMessage"><span>send message</span></a>
                                    <p class="form-messege"></p>
                                </form>

                                <div id="addedComments">
                                    <h2>COMMENTS</h2><br />


                                    @await Html.PartialAsync("_BlogCommentPartialView", Model)


                                </div>

                            }
                        </div>
                    </div>
                </div>
               
            </div>
        </div>
    </div>
</section>



@section Scripts{
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script></script>


    <script>

            $("#SendMessage").click(function (e) {
                e.preventDefault()
                var link = $(this).attr("href")
                var value = $("#hiddenId").val();
                var subject = $("#subj").next().val();
                var message = $("#message").next().val();
                var blogid = $("#blogid").text();


                console.log(link)
                console.log(message)
                console.log(blogid)

                var url = link + '?Subject=' + subject + '&Message=' + message + '&BlogId=' + blogid
                fetch(url).then(res => res.text()).then(data => {

                    console.log(data)
                    $("#addedComments").empty();

                    $("#addedComments").append(data);

                })
            })
        $(document).on("click",".deleteCmt",function (e) {
                e.preventDefault()
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        var value = $(this).prev().prev().val()
                        var url = '/Blog/DeleteComment?id=' + value;


                        fetch(url).then(response => response.json()).then(data => {
                            console.log(data.status)
                            if (data.status == 200) {
                                location.reload(true)
                            } else {
                                Swal.fire(
                                    'Not found!',
                                    'Your file can not be deleted.',
                                    'Failed'

                                )
                            }
                        }
                        );
                    }
                })

        })</script>
}

